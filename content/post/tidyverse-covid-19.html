---
title: 'Introduction to the Tidyverse'
subtitle: 'COVID-19 Testing in the US'
author: Morgan Essex
date: '2020-04-27'
slug: tidyverse-covid-19
output: 
  blogdown::html_page:
    toc: true
categories:
  - R
tags:
  - tidyverse
---


<div id="TOC">
<ul>
<li><a href="#import">Import</a></li>
<li><a href="#munge">Munge</a></li>
<li><a href="#plot">Plot</a></li>
</ul>
</div>

<p>We’re going to be using data from the COVID Tracking Project in the US. The API is easily accessible, and a woman already created a wrapper package for R to make accessing historical and current statistics incredibly simple. <!--more--></p>
<div class="figure">
<img src="../data/covid-tidyverse/covidtracking.png" />

</div>
<div id="import" class="section level3">
<h3>Import</h3>
<p>Calling <code>library(tidyverse)</code> will load all the functions we’ll need today, except we must also import <code>magrittr</code>, which provides us with the pipe (<code>%&gt;%</code>) operator for chaining syntax.</p>
<pre class="r"><code>library(tidyverse)  # data science toolkit
library(magrittr)   # corresponding operators
library(covid19us)  # scrapes https://covidtracking.com/ API
library(ggsci)      # custom color palettes
library(ggpubr)     # publication-ready plots</code></pre>
<p><br><br> Then, let’s load the complete longitudinal dataset and select the variables that will be relevant for our analysis.</p>
<pre class="r"><code>states.data &lt;- get_states_daily() %&gt;%
    select(c(&#39;state&#39;,&#39;date&#39;,&#39;positive&#39;,&#39;negative&#39;,&#39;death&#39;,&#39;total_test_results&#39;))

states.data</code></pre>
<pre><code>## # A tibble: 2,937 x 6
##    state date       positive negative death total_test_results
##    &lt;chr&gt; &lt;date&gt;        &lt;int&gt;    &lt;int&gt; &lt;int&gt;              &lt;int&gt;
##  1 AK    2020-04-26      341    15836     9              16177
##  2 AL    2020-04-26     6270    67281   216              73551
##  3 AR    2020-04-26     2941    36528    49              39469
##  4 AS    2020-04-26        0        3     0                  3
##  5 AZ    2020-04-26     6526    58285   275              64811
##  6 CA    2020-04-26    42164   483920  1710             526084
##  7 CO    2020-04-26    12968    46823   672              59791
##  8 CT    2020-04-26    25269    54542  1924              79811
##  9 DC    2020-04-26     3841    14227   178              18068
## 10 DE    2020-04-26     4034    15215   120              19249
## # … with 2,927 more rows</code></pre>
<p>Additionally, we’re going to pull a csv file from <a href="https://worldpopulationreview.com/" class="uri">https://worldpopulationreview.com/</a> that contains state-abbreviation pairs (e.g. CA, California) that we’ll use later to ‘beautify’ our plots.</p>
<pre class="r"><code>states.abbrev &lt;- read_csv(&#39;https://worldpopulationreview.com/static/states/abbr-name-list.csv&#39;)

states.abbrev</code></pre>
<pre><code>## # A tibble: 51 x 2
##    name                 abbreviation
##    &lt;chr&gt;                &lt;chr&gt;       
##  1 Alabama              AL          
##  2 Alaska               AK          
##  3 Arizona              AZ          
##  4 Arkansas             AR          
##  5 California           CA          
##  6 Colorado             CO          
##  7 Connecticut          CT          
##  8 Delaware             DE          
##  9 District Of Columbia DC          
## 10 Florida              FL          
## # … with 41 more rows</code></pre>
<p>Lastly, from that same website I have downloaded the (projected) 2020 census estimates, which we’ll read in and use to standardize our data to e.g. tests per 100,000 residents.</p>
<pre class="r"><code>states.population &lt;- &#39;../data/covid-tidyverse/covid.us.state.population.csv&#39; %&gt;%
    read_csv() %&gt;%
    select(c(&#39;rank&#39;,&#39;State&#39;,&#39;Pop&#39;))

states.population</code></pre>
<pre><code>## # A tibble: 52 x 3
##     rank State               Pop
##    &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
##  1     1 California     39937489
##  2     2 Texas          29472295
##  3     3 Florida        21992985
##  4     4 New York       19440469
##  5     5 Pennsylvania   12820878
##  6     6 Illinois       12659682
##  7     7 Ohio           11747694
##  8     8 Georgia        10736059
##  9     9 North Carolina 10611862
## 10    10 Michigan       10045029
## # … with 42 more rows</code></pre>
</div>
<div id="munge" class="section level3">
<h3>Munge</h3>
<p>To munge is to manipulate raw data. We’ll start by combining the three different datasets we have loaded to look at testing rates among the most populated states.</p>
<pre class="r"><code>states.data %&gt;%
    # add the longform name of each state for later plots
    left_join(states.abbrev, by = c(&#39;state&#39; = &#39;abbreviation&#39;)) %&gt;%
    # also that we can add the population for calculations
    left_join(states.population, by = c(&#39;name&#39; = &#39;State&#39;))</code></pre>
<pre><code>## # A tibble: 2,937 x 9
##    state date       positive negative death total_test_resu… name   rank     Pop
##    &lt;chr&gt; &lt;date&gt;        &lt;int&gt;    &lt;int&gt; &lt;int&gt;            &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1 AK    2020-04-26      341    15836     9            16177 Alas…    49  7.34e5
##  2 AL    2020-04-26     6270    67281   216            73551 Alab…    24  4.91e6
##  3 AR    2020-04-26     2941    36528    49            39469 Arka…    33  3.04e6
##  4 AS    2020-04-26        0        3     0                3 &lt;NA&gt;     NA NA     
##  5 AZ    2020-04-26     6526    58285   275            64811 Ariz…    14  7.38e6
##  6 CA    2020-04-26    42164   483920  1710           526084 Cali…     1  3.99e7
##  7 CO    2020-04-26    12968    46823   672            59791 Colo…    21  5.85e6
##  8 CT    2020-04-26    25269    54542  1924            79811 Conn…    29  3.56e6
##  9 DC    2020-04-26     3841    14227   178            18068 Dist…    NA NA     
## 10 DE    2020-04-26     4034    15215   120            19249 Dela…    46  9.83e5
## # … with 2,927 more rows</code></pre>
</div>
<div id="plot" class="section level3">
<h3>Plot</h3>
</div>
