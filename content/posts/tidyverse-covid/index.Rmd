---
title: 'A Simple Tidyverse Workflow'
author: Morgan Essex
date: '2020-05-02'
slug: tidyverse-covid-19
output:
  blogdown::html_page:
    fig_caption: true
    css: tomorrow.css
    toc: true
category: tutorial
tags:
  - tutorial
  - tidyverse
  - r-stats
  - forslund-lab
summary:
    Exploratory data analysis with COVID-19 testing and prognosis in the US.
---

This post is intended to be a follow up resource from my presentation for members of the ECRC. If you haven't seen those or are new here, check out my previous [post](../why-tidyverse) on why you should use the tidyverse. The workflow we'll be completing is a shorter but complete version of the following:

![](../why-tidyverse/data/data.science.process.png)


In later posts I will go through this workflow in more fine-grained detail with microbiome-specific examples, but for this introductory demo we are going to be using data from the [COVID Tracking Project](https://covidtracking.com/) in the US. One of my favorite things about R is the active development community: we don't need to download any files or even access this data through the API, because someone's already created a `covid19us` wrapper package to do this for us with a single line of code in R.

## Import

Calling `library(tidyverse)` will load all the packages and functions we'll need, including `magrittr`, which provides us with the pipe (`%>%`) operator and some 'aliases' useful when using chaining syntax. Sometimes I have to load this explicitly (perhaps depending on version of R) so beware. Additionally, I always load the [ggsci](https://cran.r-project.org/web/packages/ggsci/vignettes/ggsci.html) and [ggpubr](https://rpkgs.datanovia.com/ggpubr/index.html) packages for my plots.

```{r knitr, include = FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

```{r libraries}
library(tidyverse)
library(covid19us) 
library(ggsci) 
library(ggpubr)
```

Then, let's load the complete longitudinal dataset and select the variables that will be relevant for our analysis.

<!-- ```{r load.data.1} -->
<!-- states.data <- get_states_daily() %>% -->
<!--     select(c('state','date','positive','negative','death','total_test_results')) -->

<!-- states.data -->
<!-- ``` -->

<!-- Additionally, we're going to pull a csv file from https://worldpopulationreview.com/ that contains state-abbreviation pairs (e.g. CA, California) that we'll use later to 'beautify' our plots. -->

<!-- ```{r load.data.2} -->
<!-- states.abbrev <- read_csv('https://worldpopulationreview.com/static/states/abbr-name-list.csv') -->

<!-- states.abbrev -->
<!-- ``` -->

<!-- Lastly, from that same website I have downloaded the (projected) 2020 census estimates, which we'll read in and use to standardize our data to tests per 100,000 residents. -->

<!-- ```{r load.data.3} -->
<!-- states.population <- 'data/covid.us.state.population.csv' %>% -->
<!--     read_csv() %>% -->
<!--     select(c('rank','State','Pop')) -->

<!-- states.population -->
<!-- ``` -->


## Munge

To munge is to manipulate raw data. We'll start by combining the three different datasets we have loaded to look at testing rates among the most populated states.

<!-- ```{r munge.1} -->
<!-- testing.data <- states.data %>% -->
<!--     left_join(states.abbrev, by = c('state' = 'abbreviation')) %>% -->
<!--     left_join(states.population, by = c('name' = 'State')) -->

<!-- # peeking at newly joined variables -->
<!-- testing.data %>% -->
<!--     select(c('state','date','name','rank','Pop')) -->
<!-- ``` -->

<!-- Then we'll use the lubridate package within the tidyverse to quickly split the dates into month and day components so we can look at data from the 9th of March. -->

<!-- ```{r munge.2} -->
<!-- testing.data %<>% -->
<!--     mutate(month = lubridate::month(date)) %>% -->
<!--     mutate(day = lubridate::day(date)) %>% -->
<!--     filter(month >= 3) %>% -->
<!--     filter(day >= 9) -->

<!-- testing.data %>% -->
<!--     select(c('state','date','total_test_results','month','day')) -->
<!-- ``` -->


## Visualize

## Summarize 

```{css, echo = FALSE}
img {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 70%;
    padding: 10px
}
```