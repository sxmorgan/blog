---
title: 'Introduction to the Tidyverse'
subtitle: 'COVID-19 Testing in the US'
author: Morgan Essex
date: '2020-04-27'
slug: tidyverse-covid-19
categories:
  - R
tags:
  - tidyverse
description: '...'
---

We're going to be using data from the COVID Tracking Project in the US. The API is easily accessible, and a woman already created a wrapper package for R to make accessing historical and current statistics incredibly simple. 

![](../data/covid-tidyverse/covidtracking.png)

### Import

Calling `library(tidyverse)` will load all the functions we'll need today, except we must also import `magrittr`, which provides us with the pipe (`%>%`) operator for chaining syntax.
```{r knitr, include = FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

```{r libraries}
library(tidyverse)  # data science toolkit
library(magrittr)   # corresponding operators
library(covid19us)  # scrapes https://covidtracking.com/ API
library(ggsci)      # custom color palettes
library(ggpubr)     # publication-ready plots
```

<br><br>
Then, let's load the complete longitudinal dataset and select the variables that will be relevant for our analysis. 

```{r load.data.1}
states.data <- get_states_daily() %>%
    select(c('state','date','positive','negative','death','total_test_results'))

states.data
```

Additionally, we're going to pull a csv file from https://worldpopulationreview.com/ that contains state-abbreviation pairs (e.g. CA, California) that we'll use later to 'beautify' our plots. 

```{r load.data.2}
states.abbrev <- read_csv('https://worldpopulationreview.com/static/states/abbr-name-list.csv')

states.abbrev
```

Lastly, from that same website I have downloaded the (projected) 2020 census estimates, which we'll read in and use to standardize our data to e.g. tests per 100,000 residents.

```{r load.data.3}
states.population <- '../data/covid-tidyverse/covid.us.state.population.csv' %>%
    read_csv() %>%
    select(c('rank','State','Pop'))

states.population
```


### Munge
To munge is to manipulate raw data. We'll start by combining the three different datasets we have loaded.
```{r munge.1}
## let's look at testing rates among the most populated states
testing.data <- states.data %>%
    # add the longform name of each state for later plots
    left_join(states.abbrev, by = c('state' = 'abbreviation')) %>%
    # also that we can add the population for calculations
    left_join(states.population, by = c('name' = 'State'))
```

### Plot